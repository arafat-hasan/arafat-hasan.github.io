---
/**
 * Writing Card Component
 * Displays a preview of a writing piece with metadata
 */
import Badge from '../common/Badge.astro';
import ReadingTime from './ReadingTime.astro';

interface Props {
  title: string;
  description: string;
  publishedAt: Date;
  category: 'tech' | 'geopolitics' | 'literature' | 'philosophy' | 'fiction';
  slug: string;
  tags?: string[];
  content?: string; // For reading time calculation
  featured?: boolean;
  class?: string;
}

const {
  title,
  description,
  publishedAt,
  category,
  slug,
  tags = [],
  content,
  featured = false,
  class: className = '',
} = Astro.props;

// Format date
const formattedDate = publishedAt.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
});

// Build the URL
// The slug already includes the category path (e.g., "tech/post-name")
// We just need to prepend /writing/
const url = `/writing/${slug}`;
---

<article
  class={`group border border-gray-200 rounded-lg p-6 hover:shadow-lg hover:border-gray-300 transition-all ${
    featured ? 'ring-2 ring-gray-900' : ''
  } ${className}`.trim()}
>
  <a href={url} class="block">
    <div class="flex items-start gap-3 mb-3">
      <Badge text={category} variant={category} />
      {featured && (
        <Badge text="Featured" variant="default" class="bg-gray-900 text-white" />
      )}
    </div>

    <h3 class="text-xl font-semibold text-gray-900 mb-2 group-hover:text-gray-700 transition-colors">
      {title}
    </h3>

    <p class="text-gray-600 mb-4 line-clamp-3">
      {description}
    </p>

    <div class="flex items-center gap-3 text-sm text-gray-500">
      <time datetime={publishedAt.toISOString()}>
        ðŸ“… {formattedDate}
      </time>
      {content && (
        <>
          <span>â€¢</span>
          <ReadingTime content={content} />
        </>
      )}
    </div>

    {tags.length > 0 && (
      <div class="flex flex-wrap gap-2 mt-4">
        {tags.map((tag) => (
          <Badge text={tag} variant="default" />
        ))}
      </div>
    )}
  </a>
</article>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
