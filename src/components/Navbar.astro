---
import { NAV_LINKS, SITE_CONFIG } from '../config/constants';

const currentPath = Astro.url.pathname;

function isActive(href: string) {
  if (href === '/') {
    return currentPath === '/';
  }
  return currentPath.startsWith(href);
}
---

<nav class="border-b border-gray-200">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 py-4">
    <div class="flex items-center justify-between">
      <a href="/" class="text-xl font-semibold text-gray-900 hover:text-gray-700 relative z-50">
        {SITE_CONFIG.name}
      </a>

      <!-- Desktop Navigation -->
      <ul class="hidden md:flex gap-6">
        {NAV_LINKS.map((link) => (
          <li>
            <a
              href={link.href}
              class={`text-sm transition-colors ${
                isActive(link.href)
                  ? 'text-gray-900 font-medium'
                  : 'text-gray-600 hover:text-gray-900'
              }`}
            >
              {link.name}
            </a>
          </li>
        ))}
      </ul>

      <!-- Mobile Hamburger Button -->
      <button
        id="mobile-menu-button"
        class="md:hidden relative z-50 w-10 h-10 flex flex-col items-center justify-center gap-1.5 focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2 rounded"
        aria-label="Toggle mobile menu"
        aria-expanded="false"
      >
        <span class="hamburger-line w-6 h-0.5 bg-gray-900 transition-all duration-300 ease-in-out"></span>
        <span class="hamburger-line w-6 h-0.5 bg-gray-900 transition-all duration-300 ease-in-out"></span>
        <span class="hamburger-line w-6 h-0.5 bg-gray-900 transition-all duration-300 ease-in-out"></span>
      </button>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div
    id="mobile-menu"
    class="fixed inset-0 bg-black bg-opacity-50 z-40 opacity-0 pointer-events-none transition-opacity duration-300 ease-in-out md:hidden"
    aria-hidden="true"
  >
    <!-- Mobile Menu Panel -->
    <div
      id="mobile-menu-panel"
      class="absolute top-0 right-0 w-64 h-full bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out"
    >
      <nav class="flex flex-col pt-20 px-6">
        <ul class="flex flex-col gap-1">
          {NAV_LINKS.map((link) => (
            <li>
              <a
                href={link.href}
                class={`block py-3 px-4 rounded-lg text-base transition-colors ${
                  isActive(link.href)
                    ? 'bg-gray-100 text-gray-900 font-medium'
                    : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900'
                }`}
              >
                {link.name}
              </a>
            </li>
          ))}
        </ul>
      </nav>
    </div>
  </div>
</nav>

<style>
  /* Hamburger animation when menu is open */
  #mobile-menu-button.menu-open .hamburger-line:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }
  
  #mobile-menu-button.menu-open .hamburger-line:nth-child(2) {
    opacity: 0;
  }
  
  #mobile-menu-button.menu-open .hamburger-line:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
  }

  /* Prevent body scroll when menu is open */
  body.menu-open {
    overflow: hidden;
  }
</style>

<script>
  // Mobile menu toggle functionality
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuPanel = document.getElementById('mobile-menu-panel');
  
  let isMenuOpen = false;

  function toggleMenu() {
    isMenuOpen = !isMenuOpen;
    
    if (isMenuOpen) {
      // Open menu
      mobileMenuButton?.classList.add('menu-open');
      mobileMenuButton?.setAttribute('aria-expanded', 'true');
      mobileMenu?.classList.remove('pointer-events-none', 'opacity-0');
      mobileMenu?.setAttribute('aria-hidden', 'false');
      mobileMenuPanel?.classList.remove('translate-x-full');
      document.body.classList.add('menu-open');
    } else {
      // Close menu
      mobileMenuButton?.classList.remove('menu-open');
      mobileMenuButton?.setAttribute('aria-expanded', 'false');
      mobileMenu?.classList.add('pointer-events-none', 'opacity-0');
      mobileMenu?.setAttribute('aria-hidden', 'true');
      mobileMenuPanel?.classList.add('translate-x-full');
      document.body.classList.remove('menu-open');
    }
  }

  // Toggle menu on button click
  mobileMenuButton?.addEventListener('click', toggleMenu);

  // Close menu when clicking on the backdrop
  mobileMenu?.addEventListener('click', (e) => {
    if (e.target === mobileMenu) {
      toggleMenu();
    }
  });

  // Close menu when clicking on a link
  const mobileMenuLinks = mobileMenuPanel?.querySelectorAll('a');
  mobileMenuLinks?.forEach(link => {
    link.addEventListener('click', () => {
      if (isMenuOpen) {
        toggleMenu();
      }
    });
  });

  // Close menu on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isMenuOpen) {
      toggleMenu();
    }
  });

  // Handle window resize - close menu if resizing to desktop
  let resizeTimer: ReturnType<typeof setTimeout>;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      if (window.innerWidth >= 768 && isMenuOpen) {
        toggleMenu();
      }
    }, 250);
  });
</script>
