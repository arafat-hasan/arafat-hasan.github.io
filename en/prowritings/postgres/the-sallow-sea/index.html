<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="Arafat Hasan">
    <meta name="description" content="This writing is actually a draft note made for me so that I myself don’t forget what I have learned. For that, I think this note will be helpful for those who want to learn new Postgres.
 1. The Shallow Sea 1.1. PRIMARY KEY The PRIMARY KEY of a table is a combination of NOT NULL and UNIQUE constraint. Here we will see how to delete and add a primary key.">
    <meta name="keywords" content="blog,developer,personal,resume,computer,technology,programmer,curriculum vitae">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="PostgreSQL: The Sallow Sea"/>
<meta name="twitter:description" content="This writing is actually a draft note made for me so that I myself don’t forget what I have learned. For that, I think this note will be helpful for those who want to learn new Postgres.
 1. The Shallow Sea 1.1. PRIMARY KEY The PRIMARY KEY of a table is a combination of NOT NULL and UNIQUE constraint. Here we will see how to delete and add a primary key."/>

    <meta property="og:title" content="PostgreSQL: The Sallow Sea" />
<meta property="og:description" content="This writing is actually a draft note made for me so that I myself don’t forget what I have learned. For that, I think this note will be helpful for those who want to learn new Postgres.
 1. The Shallow Sea 1.1. PRIMARY KEY The PRIMARY KEY of a table is a combination of NOT NULL and UNIQUE constraint. Here we will see how to delete and add a primary key." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.arafathasan.live/en/prowritings/postgres/the-sallow-sea/" />
<meta property="article:published_time" content="2020-08-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-12T00:00:00+00:00" /><meta property="og:site_name" content="Arafat Hasan" />



    <title>
  PostgreSQL: The Sallow Sea · Arafat Hasan
</title>

    
      <link rel="canonical" href="https://www.arafathasan.live/en/prowritings/postgres/the-sallow-sea/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" integrity="sha256-gsmEoJAws/Kd3CjuOQzLie5Q3yshhvmo7YNtBG7aaEY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://www.arafathasan.live/css/coder.min.9836c03fe5c87d102278a33e86d0591ef36c89b1e17e8e547ebf84c05cee010e.css" integrity="sha256-mDbAP&#43;XIfRAieKM&#43;htBZHvNsibHhfo5Ufr&#43;EwFzuAQ4=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="https://www.arafathasan.live/css/coder-dark.min.717236c74e0a5208ef73964a9f44c6b443b689a95b270d8b2a40d0c012460dac.css" integrity="sha256-cXI2x04KUgjvc5ZKn0TGtEO2ialbJw2LKkDQwBJGDaw=" crossorigin="anonymous" media="screen" />
      
    

    
      <link rel="stylesheet" href="https://www.arafathasan.live/css/base16.solarized.light.css" />
    
      <link rel="stylesheet" href="https://www.arafathasan.live/css/custom.css" />
    

    

    <link rel="icon" type="image/png" href="https://www.arafathasan.live/assets/images/knight-2-right-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://www.arafathasan.live/assets/images/knight-2-right-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="https://www.arafathasan.live/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://www.arafathasan.live/images/apple-touch-icon.png">

    

    <meta name="generator" content="Hugo 0.75.1" />
  </head>

  
  
    
  
  <body class="colorscheme-auto"
        onload=""
  >
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://www.arafathasan.live/en">
      Arafat Hasan
    </a>
    
      
        <span id="dark-mode-toggle" class="float-right">
          <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
        </span>
      
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://www.arafathasan.live/en/about/">About Me</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://www.arafathasan.live/en/prowritings/">Tech Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://www.arafathasan.live/en/">Contact</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://www.arafathasan.live/en/comment-policy/">Policy</a>
            </li>
          
        
        
          
          
          
            
              
                <li class="navigation-item menu-separator">
                  <span>|</span>
                </li>
                
              
              <li class="navigation-item">
                <a href="https://www.arafathasan.live/bn/">বাংলা</a>
              </li>
            
          
            
          
        
        
          <li class="navigation-item separator">
            <span>|</span>
          </li>
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">PostgreSQL: The Sallow Sea</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime='2020-08-12T00:00:00Z'>
                August 12, 2020
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              26-minute read
            </span>
          </div>
          <div class="categories">
  <i class="fa fa-folder" aria-hidden="true"></i>
    <a href="https://www.arafathasan.live/en/categories/professional-writings/">professional writings</a></div>

          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <a href="https://www.arafathasan.live/en/tags/postgresql/">postgresql</a>
      <span class="separator">•</span>
    <a href="https://www.arafathasan.live/en/tags/note/">note</a>
      <span class="separator">•</span>
    <a href="https://www.arafathasan.live/en/tags/postgres/">postgres</a></div>

        </div>
      </header>

      <div>
        
          <img src='postgres-logo.png' alt="Featured image"/>
        
        
<div class="paragraph">
<p><em>This writing is actually a draft note made for me so that I myself don’t forget what I have learned. For that, I think this note will be helpful for those who want to learn new Postgres.</em></p>
</div>
<div class="sect1">
<h2 id="_the_shallow_sea">1. The Shallow Sea</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_primary_key">1.1. PRIMARY KEY</h3>
<div class="paragraph">
<p>The <code>PRIMARY KEY</code> of a table is a combination of <code>NOT NULL</code> and <code>UNIQUE</code> constraint.
Here we will see how to delete and add a primary key.</p>
</div>
<div class="paragraph">
<p>At first, we check the table description, and we have found that the <code>id</code> column is a <code>PRIMARY KEY</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>\d person;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>                                         Table &#34;public.person&#34;
      Column      |          Type          | Collation | Nullable |              Default
------------------+------------------------+-----------+----------+------------------------------------
 id               | bigint                 |           | not null | nextval(&#39;person_id_seq&#39;::regclass)
 first_name       | character varying(50)  |           | not null |
 last_name        | character varying(50)  |           | not null |
 email            | character varying(150) |           |          |
 gender           | character varying(7)   |           | not null |
 date_of_birth    | date                   |           | not null |
 country_of_birth | character varying(50)  |           | not null |
Indexes:
    &#34;person_pkey&#34; PRIMARY KEY, btree (id)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we will try to add a duplicate value to the table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# SELECT * FROM person WHERE id=1;
 id | first_name | last_name |           email           | gender | date_of_birth | country_of_birth
----+------------+-----------+---------------------------+--------+---------------+------------------
  1 | Ronda      | Skermer   | rskermer0@arstechnica.com | Female | 1993-06-30    | Argentina
(1 row)

test=# INSERT INTO person (id, first_name, last_name, email, gender, date_of_birth, country_of_birth) VALUES (1, &#39;Ronda&#39;, &#39;Skermer&#39;, &#39;rskermer0@arstechnica.com&#39;, &#39;Female&#39;, &#39;1993-06-30&#39;, &#39;Argentina&#39;);
ERROR:  duplicate key value violates unique constraint &#34;person_pkey&#34;
DETAIL:  Key (id)=(1) already exists.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Insertion value is failed as the <code>id</code> column is primary, and it says <em>duplicate key value violates unique constraint</em>. Now we will drop the primary key constraint of the <code>id</code> column and will again try to insert duplicate data into the table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# ALTER TABLE person DROP CONSTRAINT person_pkey;
ALTER TABLE
test=# \d person;
                                         Table &#34;public.person&#34;
      Column      |          Type          | Collation | Nullable |              Default
------------------+------------------------+-----------+----------+------------------------------------
 id               | bigint                 |           | not null | nextval(&#39;person_id_seq&#39;::regclass)
 first_name       | character varying(50)  |           | not null |
 last_name        | character varying(50)  |           | not null |
 email            | character varying(150) |           |          |
 gender           | character varying(7)   |           | not null |
 date_of_birth    | date                   |           | not null |
 country_of_birth | character varying(50)  |           | not null |

test=# INSERT INTO person (id, first_name, last_name, email, gender, date_of_birth, country_of_birth) VALUES (1, &#39;Ronda&#39;, &#39;Skermer&#39;, &#39;rskermer0@arstechnica.com&#39;, &#39;Female&#39;, &#39;1993-06-30&#39;, &#39;Argentina&#39;);
INSERT 0 1
test=# SELECT * FROM person WHERE id=1;
 id | first_name | last_name |           email           | gender | date_of_birth | country_of_birth
----+------------+-----------+---------------------------+--------+---------------+------------------
  1 | Ronda      | Skermer   | rskermer0@arstechnica.com | Female | 1993-06-30    | Argentina
  1 | Ronda      | Skermer   | rskermer0@arstechnica.com | Female | 1993-06-30    | Argentina
(2 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, as we can see that, after dropping the primary key constrains, we can insert a duplicate row in the table.</p>
</div>
<div class="paragraph">
<p>Now we will try to add primary key constraint in the <code>id</code> column.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# ALTER TABLE person ADD PRIMARY KEY(id);
ERROR:  could not create unique index &#34;person_pkey&#34;
DETAIL:  Key (id)=(1) is duplicated.</code></pre>
</div>
</div>
<div class="paragraph">
<p>But we had failed, as there is two-row containing the same id. Now delete one of the duplicate ids and again try to add a primary key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# DELETE FROM person WHERE id=1;
DELETE 2
test=# SELECT * FROM person WHERE id=1;
 id | first_name | last_name | email | gender | date_of_birth | country_of_birth
----+------------+-----------+-------+--------+---------------+------------------
(0 rows)

test=# INSERT INTO person (id, first_name, last_name, email, gender, date_of_birth, country_of_birth) VALUES (1, &#39;Ronda&#39;, &#39;Skermer&#39;, &#39;rskermer0@arstechnica.com&#39;, &#39;Female&#39;, &#39;1993-06-30&#39;, &#39;Argentina&#39;);
INSERT 0 1
test=# SELECT * FROM person WHERE id=1;
 id | first_name | last_name |           email           | gender | date_of_birth | country_of_birth
----+------------+-----------+---------------------------+--------+---------------+------------------
  1 | Ronda      | Skermer   | rskermer0@arstechnica.com | Female | 1993-06-30    | Argentina
(1 row)

test=# ALTER TABLE person ADD PRIMARY KEY(id);
ALTER TABLE
test=# \d person;
                                         Table &#34;public.person&#34;
      Column      |          Type          | Collation | Nullable |              Default
------------------+------------------------+-----------+----------+------------------------------------
 id               | bigint                 |           | not null | nextval(&#39;person_id_seq&#39;::regclass)
 first_name       | character varying(50)  |           | not null |
 last_name        | character varying(50)  |           | not null |
 email            | character varying(150) |           |          |
 gender           | character varying(7)   |           | not null |
 date_of_birth    | date                   |           | not null |
 country_of_birth | character varying(50)  |           | not null |
Indexes:
    &#34;person_pkey&#34; PRIMARY KEY, btree (id)

test=#</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our primary key constraint in the <code>id</code> column is back again.</p>
</div>
</div>
<div class="sect2">
<h3 id="_constraints">1.2. CONSTRAINTS</h3>
<div class="sect3">
<h4 id="_unique_constraint">1.2.1. UNIQUE constraint</h4>
<div class="paragraph">
<p>The PostgreSQL <code>UNIQUE</code> constraint ensures that the uniqueness of the values entered into a column or a field of a table.</p>
</div>
<div class="paragraph">
<p>The <code>UNIQUE</code> constraint in PostgreSQL can be applied as a column constraint or a group of column constraint or a table constraint.</p>
</div>
<div class="paragraph">
<p>The <code>UNIQUE</code> constraint in PostgreSQL is violated when more than one row for a column or combination of columns which have been used as a unique constraint in a table. Two <code>NULL</code> values for a column in different rows are different, and it does not violate the uniqueness of the UNIQUE constraint.</p>
</div>
<div class="paragraph">
<p>When a <code>UNIQUE</code> constraint is adding, an index on a column or group of columns creates automatically.</p>
</div>
<div class="paragraph">
<p>We are going to add a <code>UNIQUE CONSTRAINT</code> in the email field, and after that, we will delete the constraint of the field.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# ALTER TABLE person ADD CONSTRAINT unique_email_addr UNIQUE(email);
ALTER TABLE
test=# \d person;
                                         Table &#34;public.person&#34;
      Column      |          Type          | Collation | Nullable |              Default
------------------+------------------------+-----------+----------+------------------------------------
 id               | bigint                 |           | not null | nextval(&#39;person_id_seq&#39;::regclass)
 first_name       | character varying(50)  |           | not null |
 last_name        | character varying(50)  |           | not null |
 email            | character varying(150) |           |          |
 gender           | character varying(7)   |           | not null |
 date_of_birth    | date                   |           | not null |
 country_of_birth | character varying(50)  |           | not null |
Indexes:
    &#34;person_pkey&#34; PRIMARY KEY, btree (id)
    &#34;unique_email_addr&#34; UNIQUE CONSTRAINT, btree (email)

test=# ALTER TABLE person DROP CONSTRAINT unique_email_addr;
ALTER TABLE

test=# \d person;
                                         Table &#34;public.person&#34;
      Column      |          Type          | Collation | Nullable |              Default
------------------+------------------------+-----------+----------+------------------------------------
 id               | bigint                 |           | not null | nextval(&#39;person_id_seq&#39;::regclass)
 first_name       | character varying(50)  |           | not null |
 last_name        | character varying(50)  |           | not null |
 email            | character varying(150) |           |          |
 gender           | character varying(7)   |           | not null |
 date_of_birth    | date                   |           | not null |
 country_of_birth | character varying(50)  |           | not null |
Indexes:
    &#34;person_pkey&#34; PRIMARY KEY, btree (id)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again we will add unique constraints in the email field, but without mentioning the name of our constraint, the name of the constraint will be set by Postgres itself automatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# ALTER TABLE person ADD UNIQUE(email);
ALTER TABLE
test=# \d person;
                                         Table &#34;public.person&#34;
      Column      |          Type          | Collation | Nullable |              Default
------------------+------------------------+-----------+----------+------------------------------------
 id               | bigint                 |           | not null | nextval(&#39;person_id_seq&#39;::regclass)
 first_name       | character varying(50)  |           | not null |
 last_name        | character varying(50)  |           | not null |
 email            | character varying(150) |           |          |
 gender           | character varying(7)   |           | not null |
 date_of_birth    | date                   |           | not null |
 country_of_birth | character varying(50)  |           | not null |
Indexes:
    &#34;person_pkey&#34; PRIMARY KEY, btree (id)
    &#34;person_email_key&#34; UNIQUE CONSTRAINT, btree (email)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_check_constraint">1.2.2. CHECK Constraint</h4>
<div class="paragraph">
<p>The PostgreSQL <code>CHECK</code> constraint controls the value of a column(s) being inserted.</p>
</div>
<div class="paragraph">
<p>PostgreSQL provides the <code>CHECK</code> constraint, which allows the user to define a condition that a value entered into a table, has to satisfy before it can be accepted. The <code>CHECK</code> constraint consists of the keyword <code>CHECK</code>, followed by parenthesized conditions. The attempt will be rejected when update or insert column values that will make the condition false.</p>
</div>
<div class="paragraph">
<p>The <code>CHECK</code> constraint in PostgreSQL can be defined as a separate name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# ALTER TABLE person ADD CONSTRAINT gender_constraint CHECK (gender = &#39;Female&#39; OR gender = &#39;Male&#39;);
ALTER TABLE
test=# \d person;
                                         Table &#34;public.person&#34;
      Column      |          Type          | Collation | Nullable |              Default
------------------+------------------------+-----------+----------+------------------------------------
 id               | bigint                 |           | not null | nextval(&#39;person_id_seq&#39;::regclass)
 first_name       | character varying(50)  |           | not null |
 last_name        | character varying(50)  |           | not null |
 email            | character varying(150) |           |          |
 gender           | character varying(7)   |           | not null |
 date_of_birth    | date                   |           | not null |
 country_of_birth | character varying(50)  |           | not null |
Indexes:
    &#34;person_pkey&#34; PRIMARY KEY, btree (id)
    &#34;person_email_key&#34; UNIQUE CONSTRAINT, btree (email)
Check constraints:
    &#34;gender_constraint&#34; CHECK (gender::text = &#39;Female&#39;::text OR gender::text = &#39;Male&#39;::text)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_delete">1.3. DELETE</h3>
<div class="paragraph">
<p>Following is the usage of the PostgreSQL <code>DELETE</code> command to delete data of a PostgreSQL table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>DELETE FROM table_name ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>table_name</code> is the associated table, executing this command will delete all the rows of the associated table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>DELETE FROM table_name WHERE condition;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we don’t want to delete all of the rows of a table, but some specific rows which match the &#34;condition&#34;, execute the above.</p>
</div>
<div class="paragraph">
<p>First, try to delete all records from a table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# DELETE FROM person;
DELETE 1000
test=# SELECT * FROM person;
 id | first_name | last_name | email | gender | date_of_birth | country_of_birth
----+------------+-----------+-------+--------+---------------+------------------
(0 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no record in the <code>person</code> table now. For our learning purpose, retrieve data from the SQL file for the table again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# \i /path/to/person.sql
psql:/path/to/person.sql:9: ERROR:  relation &#34;person&#34; already exists
INSERT 0 1
--More--
test=# \d person;
                                         Table &#34;public.person&#34;
      Column      |          Type          | Collation | Nullable |              Default
------------------+------------------------+-----------+----------+------------------------------------
 id               | bigint                 |           | not null | nextval(&#39;person_id_seq&#39;::regclass)
 first_name       | character varying(50)  |           | not null |
 last_name        | character varying(50)  |           | not null |
 email            | character varying(150) |           |          |
 gender           | character varying(7)   |           | not null |
 date_of_birth    | date                   |           | not null |
 country_of_birth | character varying(50)  |           | not null |
Indexes:
    &#34;person_pkey&#34; PRIMARY KEY, btree (id)
    &#34;person_email_key&#34; UNIQUE CONSTRAINT, btree (email)
Check constraints:
    &#34;gender_constraint&#34; CHECK (gender::text = &#39;Female&#39;::text OR gender::text = &#39;Male&#39;::text)

test=# SELECT * FROM person LIMIT 10;
  id  | first_name |   last_name   |             email              | gender | date_of_birth | country_of_birth
------+------------+---------------+--------------------------------+--------+---------------+------------------
 1002 | Ronda      | Skermer       | rskermer0@arstechnica.com      | Female | 1993-06-30    | Argentina
 1003 | Hamid      | Abbett        | habbett1@cbc.ca                | Male   | 1995-08-31    | Ethiopia
 1004 | Francis    | Nickerson     | fnickerson2@mac.com            | Male   | 1998-03-16    | Portugal
 1005 | Erminie    | M&#39;Quharg      | emquharg3@e-recht24.de         | Female | 1999-03-13    | Mozambique
 1006 | Teodoro    | Trimmill      |                                | Male   | 1982-04-30    | China
 1007 | Reilly     | Amesbury      | ramesbury5@businessinsider.com | Male   | 1990-12-31    | China
 1008 | West       | Elphey        |                                | Male   | 2004-03-29    | Indonesia
 1009 | Letta      | Caurah        | lcaurah7@yale.edu              | Female | 1994-09-09    | Indonesia
 1010 | Elset      | Agass         | eagass8@rambler.ru             | Female | 2004-06-26    | China
 1011 | Aurore     | Drillingcourt | adrillingcourt9@cnet.com       | Female | 1977-10-19    | China
(10 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now try to delete a specific row or rows with the matching condition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# DELETE FROM person WHERE id = 1002;
DELETE 1
test=# SELECT * FROM person LIMIT 10;
  id  | first_name |   last_name   |             email              | gender | date_of_birth | country_of_birth
------+------------+---------------+--------------------------------+--------+---------------+------------------
 1003 | Hamid      | Abbett        | habbett1@cbc.ca                | Male   | 1995-08-31    | Ethiopia
 1004 | Francis    | Nickerson     | fnickerson2@mac.com            | Male   | 1998-03-16    | Portugal
 1005 | Erminie    | M&#39;Quharg      | emquharg3@e-recht24.de         | Female | 1999-03-13    | Mozambique
 1006 | Teodoro    | Trimmill      |                                | Male   | 1982-04-30    | China
 1007 | Reilly     | Amesbury      | ramesbury5@businessinsider.com | Male   | 1990-12-31    | China
 1008 | West       | Elphey        |                                | Male   | 2004-03-29    | Indonesia
 1009 | Letta      | Caurah        | lcaurah7@yale.edu              | Female | 1994-09-09    | Indonesia
 1010 | Elset      | Agass         | eagass8@rambler.ru             | Female | 2004-06-26    | China
 1011 | Aurore     | Drillingcourt | adrillingcourt9@cnet.com       | Female | 1977-10-19    | China
 1012 | Ilse       | Goldman       | igoldmana@ihg.com              | Female | 2001-07-31    | Mongolia
(10 rows)

test=# DELETE FROM person WHERE gender=&#39;Female&#39; AND country_of_birth=&#39;China&#39;;
DELETE 94
test=# SELECT * FROM person WHERE gender=&#39;Female&#39; AND country_of_birth=&#39;China&#39;;
 id | first_name | last_name | email | gender | date_of_birth | country_of_birth
----+------------+-----------+-------+--------+---------------+------------------
(0 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For our learning purpose, now we will delete every record from the person table and restore it from our SQL file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# DELETE FROM person;
DELETE 905
test=# \i /path/to/person.sql
psql:/path/to/person.sql:9: ERROR:  relation &#34;person&#34; already exists
INSERT 0 1
--More--</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_update">1.4. UPDATE</h3>
<div class="paragraph">
<p>UPDATE command is used to modify existing data of a table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# SELECT * FROM person;
  id  |   first_name   |      last_name      |                  email                  | gender | date_of_birth |         country_of_birth
------+----------------+---------------------+-----------------------------------------+--------+---------------+----------------------------------
 2002 | Ronda          | Skermer             | rskermer0@arstechnica.com               | Female | 1993-06-30    | Argentina
 2003 | Hamid          | Abbett              | habbett1@cbc.ca                         | Male   | 1995-08-31    | Ethiopia
 2004 | Francis        | Nickerson           | fnickerson2@mac.com                     | Male   | 1998-03-16    | Portugal
 2005 | Erminie        | M&#39;Quharg            | emquharg3@e-recht24.de                  | Female | 1999-03-13    | Mozambique
 2006 | Teodoro        | Trimmill            |                                         | Male   | 1982-04-30    | China
 2007 | Reilly         | Amesbury            | ramesbury5@businessinsider.com          | Male   | 1990-12-31    | China
 2008 | West           | Elphey              |                                         | Male   | 2004-03-29    | Indonesia
--More--

test=# UPDATE person SET email  = &#39;teodoro@gmail.com&#39; WHERE id = 2006;
UPDATE 1
test=# SELECT * FROM person WHERE id = 2006;
  id  | first_name | last_name |       email       | gender | date_of_birth | country_of_birth
------+------------+-----------+-------------------+--------+---------------+------------------
 2006 | Teodoro    | Trimmill  | teodoro@gmail.com | Male   | 1982-04-30    | China
(1 row)

test=# UPDATE person SET last_name = &#39;Trimmil&#39;, email = &#39;teodoro@hotmail.com&#39; WHERE id = 2006;
UPDATE 1
test=# SELECT * FROM person WHERE id = 2006;
  id  | first_name | last_name |        email        | gender | date_of_birth | country_of_birth
------+------------+-----------+---------------------+--------+---------------+------------------
 2006 | Teodoro    | Trimmil   | teodoro@hotmail.com | Male   | 1982-04-30    | China
(1 row)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_on_conflict">1.5. ON CONFLICT</h3>
<div class="sect3">
<h4 id="_do_nothing">1.5.1. DO NOTHING</h4>
<div class="paragraph">
<p>This means do nothing if the row already exists in the table. It handles duplicate key errors.</p>
</div>
<div class="paragraph">
<p>First, we try to enter the duplicate record.</p>
</div>
<div class="paragraph">
<p><sub><em>Command</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">2002</span><span class="p">,</span> <span class="s1">&#39;Ronda&#39;</span><span class="p">,</span> <span class="s1">&#39;Dante&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;dante@hotmaill.com&#39;</span><span class="p">,</span> <span class="nb">DATE</span> <span class="s1">&#39;1980-03-12&#39;</span><span class="p">,</span> <span class="s1">&#39;Sri Lanka&#39;</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As expected, an ERROR message is thrown.</p>
</div>
<div class="paragraph">
<p><sub><em>Output</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>ERROR:  duplicate key value violates unique constraint &#34;person_pkey&#34;
DETAIL:  Key (id)=(2002) already exists.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we try to enter the duplicate record with <code>ON CONFLICT(id) DO NOTHING</code> and handle the error.</p>
</div>
<div class="paragraph">
<p><sub><em>Command</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">2002</span><span class="p">,</span> <span class="s1">&#39;Ronda&#39;</span><span class="p">,</span> <span class="s1">&#39;Dante&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;dante@hotmaill.com&#39;</span><span class="p">,</span> <span class="nb">DATE</span> <span class="s1">&#39;1980-03-12&#39;</span><span class="p">,</span> <span class="s1">&#39;Sri Lanka&#39;</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">NOTHING</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output message is saying <code>0 0</code>, which means no insert operation is held.</p>
</div>
<div class="paragraph">
<p><sub><em>Output</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>INSERT 0 0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_do_update_set">1.5.2. DO UPDATE SET</h4>
<div class="paragraph">
<p>This update some fields in the table.</p>
</div>
<div class="paragraph">
<p>We will update this record in a way that conflicts with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# SELECT * FROM person WHERE id = 2002;
  id  | first_name | last_name |             email         | gender | date_of_birth | country_of_birth
------+------------+-----------+---------------------------+--------+---------------+------------------
 2002 | Ronda      | Skermer   | rskermer0@arstechnica.com | Female | 1993-06-30    | Argentina
(1 row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>EXCLUDED</code> refers to the new conflicted record which is trying to be inserted.</p>
</div>
<div class="paragraph">
<p><sub><em>Command</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">2002</span><span class="p">,</span> <span class="s1">&#39;Rudi&#39;</span><span class="p">,</span> <span class="s1">&#39;Donte&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;donte@hotmaill.com&#39;</span><span class="p">,</span> <span class="nb">DATE</span> <span class="s1">&#39;1980-03-12&#39;</span><span class="p">,</span> <span class="s1">&#39;Sri Lanka&#39;</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="n">first_name</span><span class="o">=</span><span class="n">EXCLUDED</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="n">EXCLUDED</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">EXCLUDED</span><span class="p">.</span><span class="n">email</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><sub><em>Output</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>INSERT 0 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Despite the conflict, the updated record is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# SELECT * FROM person WHERE id = 2002;
  id  | first_name | last_name |       email        | gender | date_of_birth | country_of_birth
------+------------+-----------+--------------------+--------+---------------+------------------
 2002 | Rudi       | Donte     | donte@hotmaill.com | Female | 1993-06-30    | Argentina
(1 row)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_foreign_keys_joins_and_relationships">1.6. Foreign Keys, Joins and Relationships</h3>
<div class="paragraph">
<p><span class="image"><img src="./foreign-primary-relations.png" alt="Forign Key" width="Primary Key and Relations"/></span></p>
</div>
<div class="paragraph">
<p>Adding relations between tables
We will now drop the previous tables and create new ones with relations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# \dt
           List of relations
 Schema |  Name  | Type  |    Owner
--------+--------+-------+--------------
 public | car    | table | arafat_hasan
 public | person | table | arafat_hasan
(2 rows)

test=# DROP TABLE car;
DROP TABLE
test=# DROP TABLE person;
DROP TABLE
test=# \dt
Did not find any relations.
test=# \i /path/to/new/file/car-person.sql
CREATE TABLE
CREATE TABLE
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
INSERT 0 1
test=# \dt
           List of relations
 Schema |  Name  | Type  |    Owner
--------+--------+-------+--------------
 public | car    | table | arafat_hasan
 public | person | table | arafat_hasan
(2 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our new SQL file, which is named <code>car-person.sql</code> is in bellow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">car</span> <span class="p">(</span>
	<span class="n">id</span> <span class="n">BIGSERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
	<span class="n">make</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">model</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">price</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>


<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="p">(</span>
	<span class="n">id</span> <span class="n">BIGSERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
	<span class="n">first_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">last_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span>
	<span class="n">gender</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">date_of_birth</span> <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">country_of_birth</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">car_id</span> <span class="nb">BIGINT</span> <span class="k">REFERENCES</span> <span class="n">car</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
	<span class="k">UNIQUE</span><span class="p">(</span><span class="n">car_id</span><span class="p">)</span>
<span class="p">);</span>


<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">car</span> <span class="p">(</span><span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Daewoo&#39;</span><span class="p">,</span> <span class="s1">&#39;Leganza&#39;</span><span class="p">,</span> <span class="s1">&#39;241058.40&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">car</span> <span class="p">(</span><span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Mitsubishi&#39;</span><span class="p">,</span> <span class="s1">&#39;Montero&#39;</span><span class="p">,</span> <span class="s1">&#39;269595.21&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">car</span> <span class="p">(</span><span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Kia&#39;</span><span class="p">,</span> <span class="s1">&#39;Rio&#39;</span><span class="p">,</span> <span class="s1">&#39;245275.16&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">car</span> <span class="p">(</span><span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Jaguar&#39;</span><span class="p">,</span> <span class="s1">&#39;X-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;41665.96&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">car</span> <span class="p">(</span><span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Lincoln&#39;</span><span class="p">,</span> <span class="s1">&#39;Mark VIII&#39;</span><span class="p">,</span> <span class="s1">&#39;163843.38&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">car</span> <span class="p">(</span><span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;GMC&#39;</span><span class="p">,</span> <span class="s1">&#39;Rally Wagon 3500&#39;</span><span class="p">,</span> <span class="s1">&#39;231169.05&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">car</span> <span class="p">(</span><span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Cadillac&#39;</span><span class="p">,</span> <span class="s1">&#39;Escalade ESV&#39;</span><span class="p">,</span> <span class="s1">&#39;279951.34&#39;</span><span class="p">);</span>


<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Hamid&#39;</span><span class="p">,</span> <span class="s1">&#39;Abbett&#39;</span><span class="p">,</span> <span class="s1">&#39;habbett1@cbc.ca&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;1995-08-31&#39;</span><span class="p">,</span> <span class="s1">&#39;Ethiopia&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Francis&#39;</span><span class="p">,</span> <span class="s1">&#39;Nickerson&#39;</span><span class="p">,</span> <span class="s1">&#39;fnickerson2@mac.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;1998-03-16&#39;</span><span class="p">,</span> <span class="s1">&#39;Portugal&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Erminie&#39;</span><span class="p">,</span> <span class="s1">&#39;M</span><span class="se">&#39;&#39;</span><span class="s1">Quharg&#39;</span><span class="p">,</span> <span class="s1">&#39;emquharg3@e-recht24.de&#39;</span><span class="p">,</span> <span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;1999-03-13&#39;</span><span class="p">,</span> <span class="s1">&#39;Mozambique&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Teodoro&#39;</span><span class="p">,</span> <span class="s1">&#39;Trimmill&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;1982-04-30&#39;</span><span class="p">,</span> <span class="s1">&#39;China&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Reilly&#39;</span><span class="p">,</span> <span class="s1">&#39;Amesbury&#39;</span><span class="p">,</span> <span class="s1">&#39;ramesbury5@businessinsider.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;1990-12-31&#39;</span><span class="p">,</span> <span class="s1">&#39;China&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;West&#39;</span><span class="p">,</span> <span class="s1">&#39;Elphey&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;2004-03-29&#39;</span><span class="p">,</span> <span class="s1">&#39;Indonesia&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Letta&#39;</span><span class="p">,</span> <span class="s1">&#39;Caurah&#39;</span><span class="p">,</span> <span class="s1">&#39;lcaurah7@yale.edu&#39;</span><span class="p">,</span> <span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;1994-09-09&#39;</span><span class="p">,</span> <span class="s1">&#39;Indonesia&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Elset&#39;</span><span class="p">,</span> <span class="s1">&#39;Agass&#39;</span><span class="p">,</span> <span class="s1">&#39;eagass8@rambler.ru&#39;</span><span class="p">,</span> <span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;2004-06-26&#39;</span><span class="p">,</span> <span class="s1">&#39;China&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Aurore&#39;</span><span class="p">,</span> <span class="s1">&#39;Drillingcourt&#39;</span><span class="p">,</span> <span class="s1">&#39;adrillingcourt9@cnet.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;1977-10-19&#39;</span><span class="p">,</span> <span class="s1">&#39;China&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Ilse&#39;</span><span class="p">,</span> <span class="s1">&#39;Goldman&#39;</span><span class="p">,</span> <span class="s1">&#39;igoldmana@ihg.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;2001-07-31&#39;</span><span class="p">,</span> <span class="s1">&#39;Mongolia&#39;</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s take a look at the two new tables to see what’s inside.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# SELECT * FROM person;
 id | first_name |   last_name   |             email              | gender | date_of_birth | country_of_birth | car_id
----+------------+---------------+--------------------------------+--------+---------------+------------------+--------
  1 | Hamid      | Abbett        | habbett1@cbc.ca                | Male   | 1995-08-31    | Ethiopia         |
  2 | Francis    | Nickerson     | fnickerson2@mac.com            | Male   | 1998-03-16    | Portugal         |
  3 | Erminie    | M&#39;Quharg      | emquharg3@e-recht24.de         | Female | 1999-03-13    | Mozambique       |
  4 | Teodoro    | Trimmill      |                                | Male   | 1982-04-30    | China            |
  5 | Reilly     | Amesbury      | ramesbury5@businessinsider.com | Male   | 1990-12-31    | China            |
  6 | West       | Elphey        |                                | Male   | 2004-03-29    | Indonesia        |
  7 | Letta      | Caurah        | lcaurah7@yale.edu              | Female | 1994-09-09    | Indonesia        |
  8 | Elset      | Agass         | eagass8@rambler.ru             | Female | 2004-06-26    | China            |
  9 | Aurore     | Drillingcourt | adrillingcourt9@cnet.com       | Female | 1977-10-19    | China            |
 10 | Ilse       | Goldman       | igoldmana@ihg.com              | Female | 2001-07-31    | Mongolia         |
(10 rows)

test=# SELECT * FROM car;
 id |    make    |      model       |   price
----+------------+------------------+-----------
  1 | Daewoo     | Leganza          | 241058.40
  2 | Mitsubishi | Montero          | 269595.21
  3 | Kia        | Rio              | 245275.16
  4 | Jaguar     | X-Type           |  41665.96
  5 | Lincoln    | Mark VIII        | 163843.38
  6 | GMC        | Rally Wagon 3500 | 231169.05
  7 | Cadillac   | Escalade ESV     | 279951.34
(7 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As expected, there is no value in the <code>car_id</code> column in <code>person</code> as we did not insert any value there.</p>
</div>
<div class="paragraph">
<p>As can be seen below, we have set the foreign key correctly, and it has a UNIQUE constraint and <code>car_id</code> referencing to <code>car.id</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# \d person;
                                         Table &#34;public.person&#34;
      Column      |          Type          | Collation | Nullable |              Default
------------------+------------------------+-----------+----------+------------------------------------
 id               | bigint                 |           | not null | nextval(&#39;person_id_seq&#39;::regclass)
 first_name       | character varying(50)  |           | not null |
 last_name        | character varying(50)  |           | not null |
 email            | character varying(150) |           |          |
 gender           | character varying(7)   |           | not null |
 date_of_birth    | date                   |           | not null |
 country_of_birth | character varying(50)  |           | not null |
 car_id           | bigint                 |           |          |
Indexes:
    &#34;person_pkey&#34; PRIMARY KEY, btree (id)
    &#34;person_car_id_key&#34; UNIQUE CONSTRAINT, btree (car_id)
Foreign-key constraints:
    &#34;person_car_id_fkey&#34; FOREIGN KEY (car_id) REFERENCES car(id)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s assign the Mitsubishi, which ID is 2 from the car table to Hamid Abbett of the person table which ID is 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# UPDATE person SET car_id = 2 WHERE id = 1;
UPDATE 1
test=# SELECT * FROM person;
 id | first_name |   last_name   |             email              | gender | date_of_birth | country_of_birth | car_id
----+------------+---------------+--------------------------------+--------+---------------+------------------+--------
  2 | Francis    | Nickerson     | fnickerson2@mac.com            | Male   | 1998-03-16    | Portugal         |
  3 | Erminie    | M&#39;Quharg      | emquharg3@e-recht24.de         | Female | 1999-03-13    | Mozambique       |
  4 | Teodoro    | Trimmill      |                                | Male   | 1982-04-30    | China            |
  5 | Reilly     | Amesbury      | ramesbury5@businessinsider.com | Male   | 1990-12-31    | China            |
  6 | West       | Elphey        |                                | Male   | 2004-03-29    | Indonesia        |
  7 | Letta      | Caurah        | lcaurah7@yale.edu              | Female | 1994-09-09    | Indonesia        |
  8 | Elset      | Agass         | eagass8@rambler.ru             | Female | 2004-06-26    | China            |
  9 | Aurore     | Drillingcourt | adrillingcourt9@cnet.com       | Female | 1977-10-19    | China            |
 10 | Ilse       | Goldman       | igoldmana@ihg.com              | Female | 2001-07-31    | Mongolia         |
  1 | Hamid      | Abbett        | habbett1@cbc.ca                | Male   | 1995-08-31    | Ethiopia         |      2
(10 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s also add a car to Francis Nickerson.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>UPDATE person SET car_id = 1 WHERE id = 2;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s try to give one car to two people and see what happens.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# UPDATE person SET car_id = 1 WHERE id = 3;
ERROR:  duplicate key value violates unique constraint &#34;person_car_id_key&#34;
DETAIL:  Key (car_id)=(1) already exists.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Okay, now assign other cars to specific persons. This is the final table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code> id | first_name |   last_name   |             email              | gender | date_of_birth | country_of_birth | car_id
----+------------+---------------+--------------------------------+--------+---------------+------------------+--------
  5 | Reilly     | Amesbury      | ramesbury5@businessinsider.com | Male   | 1990-12-31    | China            |
  9 | Aurore     | Drillingcourt | adrillingcourt9@cnet.com       | Female | 1977-10-19    | China            |
 10 | Ilse       | Goldman       | igoldmana@ihg.com              | Female | 2001-07-31    | Mongolia         |
  1 | Hamid      | Abbett        | habbett1@cbc.ca                | Male   | 1995-08-31    | Ethiopia         |      2
  2 | Francis    | Nickerson     | fnickerson2@mac.com            | Male   | 1998-03-16    | Portugal         |      1
  3 | Erminie    | M&#39;Quharg      | emquharg3@e-recht24.de         | Female | 1999-03-13    | Mozambique       |      7
  4 | Teodoro    | Trimmill      |                                | Male   | 1982-04-30    | China            |      5
  8 | Elset      | Agass         | eagass8@rambler.ru             | Female | 2004-06-26    | China            |      4
  7 | Letta      | Caurah        | lcaurah7@yale.edu              | Female | 1994-09-09    | Indonesia        |      6
  6 | West       | Elphey        |                                | Male   | 2004-03-29    | Indonesia        |      3
(10 rows)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_delete_record_with_foreign_keys">1.6.1. Delete Record with Foreign Keys</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# DELETE FROM car WHERE id = 7;
ERROR:  update or delete on table &#34;car&#34; violates foreign key constraint &#34;person_car_id_fkey&#34; on table &#34;person&#34;
DETAIL:  Key (id)=(7) is still referenced from table &#34;person&#34;.
test=# DELETE FROM person WHERE id = 3;
DELETE 1
test=# SELECT * FROM person;
 id | first_name |   last_name   |             email              | gender | date_of_birth | country_of_birth | car_id
----+------------+---------------+--------------------------------+--------+---------------+------------------+--------
  5 | Reilly     | Amesbury      | ramesbury5@businessinsider.com | Male   | 1990-12-31    | China            |
  9 | Aurore     | Drillingcourt | adrillingcourt9@cnet.com       | Female | 1977-10-19    | China            |
 10 | Ilse       | Goldman       | igoldmana@ihg.com              | Female | 2001-07-31    | Mongolia         |
  1 | Hamid      | Abbett        | habbett1@cbc.ca                | Male   | 1995-08-31    | Ethiopia         |      2
  2 | Francis    | Nickerson     | fnickerson2@mac.com            | Male   | 1998-03-16    | Portugal         |      1
  4 | Teodoro    | Trimmill      |                                | Male   | 1982-04-30    | China            |      5
  8 | Elset      | Agass         | eagass8@rambler.ru             | Female | 2004-06-26    | China            |      4
  7 | Letta      | Caurah        | lcaurah7@yale.edu              | Female | 1994-09-09    | Indonesia        |      6
  6 | West       | Elphey        |                                | Male   | 2004-03-29    | Indonesia        |      3
(9 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>It turns out that we can’t delete a record which is assigned with the <code>person</code> table from the <code>car</code> table, but we can delete any record from the <code>person</code> table. This is because there is a relation from the <code>person</code> table to the <code>car</code> table.</p>
</div>
<div class="paragraph">
<p>To delete a record from the <code>car</code> table, we have to delete the corresponding record in the <code>person</code> table or set the <code>car_id</code> of that record to NULL.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_join">1.7. JOIN</h3>
<div class="paragraph">
<p>A JOIN clause is used to combine rows from two or more tables, based on a related column between them.</p>
</div>
<div class="sect3">
<h4 id="_inner_join">1.7.1. INNER JOIN</h4>
<div class="paragraph">
<p>The INNER JOIN keyword selects records that have matching values in both tables.</p>
</div>
<div class="paragraph">
<p>The INNER JOIN creates a new result table by combining column values of two tables (table1 and table2) based upon the join-predicate. The query compares each row of table1 with each row of table2 to find all pairs of rows which satisfy the join-predicate. When the join-predicate is satisfied, column values for each matched pair of rows of A and B are combined into a result row.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">table1</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">table2</span>
<span class="k">ON</span> <span class="n">table1</span><span class="p">.</span><span class="k">column_name</span> <span class="o">=</span> <span class="n">table2</span><span class="p">.</span><span class="k">column_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="./inner-join.gif" alt="INNER JOIN"/></span></p>
</div>
<div class="paragraph">
<p>Now let’s join our tables based on foreign keys.</p>
</div>
<div class="paragraph">
<p><sub><em>Command</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span>
<span class="k">JOIN</span> <span class="n">car</span> <span class="k">ON</span> <span class="n">person</span><span class="p">.</span><span class="n">car_id</span> <span class="o">=</span> <span class="n">car</span><span class="p">.</span><span class="n">id</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><sub><em>Output</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code> id | first_name | last_name |         email          | gender | date_of_birth | country_of_birth | car_id | id |    make    |      model       |   price
----+------------+-----------+------------------------+--------+---------------+------------------+--------+----+------------+------------------+-----------
  2 | Francis    | Nickerson | fnickerson2@mac.com    | Male   | 1998-03-16    | Portugal         |      1 |  1 | Daewoo     | Leganza          | 241058.40
  1 | Hamid      | Abbett    | habbett1@cbc.ca        | Male   | 1995-08-31    | Ethiopia         |      2 |  2 | Mitsubishi | Montero          | 269595.21
  6 | West       | Elphey    |                        | Male   | 2004-03-29    | Indonesia        |      3 |  3 | Kia        | Rio              | 245275.16
  8 | Elset      | Agass     | eagass8@rambler.ru     | Female | 2004-06-26    | China            |      4 |  4 | Jaguar     | X-Type           |  41665.96
  4 | Teodoro    | Trimmill  |                        | Male   | 1982-04-30    | China            |      5 |  5 | Lincoln    | Mark VIII        | 163843.38
  7 | Letta      | Caurah    | lcaurah7@yale.edu      | Female | 1994-09-09    | Indonesia        |      6 |  6 | GMC        | Rally Wagon 3500 | 231169.05
  3 | Erminie    | M&#39;Quharg  | emquharg3@e-recht24.de | Female | 1999-03-13    | Mozambique       |      7 |  7 | Cadillac   | Escalade ESV     | 279951.34
(7 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p><sub><em>Command</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">person</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">person</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span> <span class="n">car</span><span class="p">.</span><span class="n">make</span><span class="p">,</span> <span class="n">car</span><span class="p">.</span><span class="n">model</span><span class="p">,</span> <span class="n">car</span><span class="p">.</span><span class="n">price</span>
<span class="k">FROM</span> <span class="n">person</span>
<span class="k">JOIN</span> <span class="n">car</span> <span class="k">ON</span> <span class="n">person</span><span class="p">.</span><span class="n">car_id</span> <span class="o">=</span> <span class="n">car</span><span class="p">.</span><span class="n">id</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><sub><em>Output</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code> first_name | last_name |    make    |      model       |   price
------------+-----------+------------+------------------+-----------
 Francis    | Nickerson | Daewoo     | Leganza          | 241058.40
 Hamid      | Abbett    | Mitsubishi | Montero          | 269595.21
 West       | Elphey    | Kia        | Rio              | 245275.16
 Elset      | Agass     | Jaguar     | X-Type           |  41665.96
 Teodoro    | Trimmill  | Lincoln    | Mark VIII        | 163843.38
 Letta      | Caurah    | GMC        | Rally Wagon 3500 | 231169.05
 Erminie    | M&#39;Quharg  | Cadillac   | Escalade ESV     | 279951.34
(7 rows)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_left_join">1.7.2. LEFT JOIN</h4>
<div class="paragraph">
<p>The LEFT JOIN keyword returns all records from the left table (table1), and the matched records from the right table (table2). The result is NULL from the right side, if there is no match.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./left-join.gif" alt="LEFT JOIN"/></span></p>
</div>
<div class="paragraph">
<p><sub><em>Command</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">person</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">person</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span> <span class="n">car</span><span class="p">.</span><span class="n">make</span><span class="p">,</span> <span class="n">car</span><span class="p">.</span><span class="n">model</span><span class="p">,</span> <span class="n">car</span><span class="p">.</span><span class="n">price</span>
<span class="k">FROM</span> <span class="n">person</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">car</span> <span class="k">ON</span> <span class="n">person</span><span class="p">.</span><span class="n">car_id</span> <span class="o">=</span> <span class="n">car</span><span class="p">.</span><span class="n">id</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><sub><em>Output</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code> first_name |   last_name   |    make    |      model       |   price
------------+---------------+------------+------------------+-----------
 Francis    | Nickerson     | Daewoo     | Leganza          | 241058.40
 Hamid      | Abbett        | Mitsubishi | Montero          | 269595.21
 West       | Elphey        | Kia        | Rio              | 245275.16
 Elset      | Agass         | Jaguar     | X-Type           |  41665.96
 Teodoro    | Trimmill      | Lincoln    | Mark VIII        | 163843.38
 Letta      | Caurah        | GMC        | Rally Wagon 3500 | 231169.05
 Erminie    | M&#39;Quharg      | Cadillac   | Escalade ESV     | 279951.34
 Ilse       | Goldman       |            |                  |
 Aurore     | Drillingcourt |            |                  |
 Reilly     | Amesbury      |            |                  |
(10 rows)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_right_join">1.7.3. RIGHT JOIN</h4>
<div class="paragraph">
<p>The RIGHT JOIN keyword returns all records from the right table (table2), and the matched records from the left table (table1). The result is NULL from the left side, when there is no match.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./right-join.gif" alt="RIGHT JOIN"/></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_full_outer_join">1.7.4. FULL OUTER JOIN</h4>
<div class="paragraph">
<p>The FULL OUTER JOIN keyword returns all records when there are a match in left (table1) or right (table2) table records.</p>
</div>
<div class="paragraph">
<p>Note: FULL OUTER JOIN can potentially return very large result-sets!</p>
</div>
<div class="paragraph">
<p>FULL OUTER JOIN and FULL JOIN are the same.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./full-outer-join.gif" alt="FULL OUTER JOIN"/></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exporting_query_results_to_csv">1.8. Exporting Query Results to CSV</h3>
<div class="paragraph">
<p>By typing <code>\?</code> and check the help. In the Input/Output section, it says that <code>\copy …​    perform SQL COPY with data stream to the client host</code>.</p>
</div>
<div class="paragraph">
<p>We will save this query to a CSV file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# SELECT person.first_name, person.last_name, car.make, car.model, car.price
FROM person
LEFT JOIN car ON person.car_id = car.id;
 first_name |   last_name   |    make    |      model       |   price
------------+---------------+------------+------------------+-----------
 Francis    | Nickerson     | Daewoo     | Leganza          | 241058.40
 Hamid      | Abbett        | Mitsubishi | Montero          | 269595.21
 West       | Elphey        | Kia        | Rio              | 245275.16
 Elset      | Agass         | Jaguar     | X-Type           |  41665.96
 Teodoro    | Trimmill      | Lincoln    | Mark VIII        | 163843.38
 Letta      | Caurah        | GMC        | Rally Wagon 3500 | 231169.05
 Ilse       | Goldman       |            |                  |
 Aurore     | Drillingcourt |            |                  |
 Reilly     | Amesbury      |            |                  |
(9 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p><sub><em>Command</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="err">\</span><span class="k">copy</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">person</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">person</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span> <span class="n">car</span><span class="p">.</span><span class="n">make</span><span class="p">,</span> <span class="n">car</span><span class="p">.</span><span class="n">model</span><span class="p">,</span> <span class="n">car</span><span class="p">.</span><span class="n">price</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">car</span> <span class="k">ON</span> <span class="n">car</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">person</span><span class="p">.</span><span class="n">car_id</span><span class="p">)</span> <span class="k">TO</span> <span class="s1">&#39;/home/arafat_hasan/Downloads/results.csv&#39;</span> <span class="k">DELIMITER</span> <span class="s1">&#39;,&#39;</span> <span class="n">CSV</span> <span class="n">HEADER</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><sub><em>Output</em></sub></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>COPY 9</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query is stored in the CSV file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_serials_and_sequences">1.9. Serials and Sequences</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# \d person;
                                         Table &#34;public.person&#34;
      Column      |          Type          | Collation | Nullable |              Default
------------------+------------------------+-----------+----------+------------------------------------
 id               | bigint                 |           | not null | nextval(&#39;person_id_seq&#39;::regclass)
 first_name       | character varying(50)  |           | not null |
 last_name        | character varying(50)  |           | not null |
 email            | character varying(150) |           |          |
 gender           | character varying(7)   |           | not null |
 date_of_birth    | date                   |           | not null |
 country_of_birth | character varying(50)  |           | not null |
 car_id           | bigint                 |           |          |
Indexes:
    &#34;person_pkey&#34; PRIMARY KEY, btree (id)
    &#34;person_car_id_key&#34; UNIQUE CONSTRAINT, btree (car_id)
Foreign-key constraints:
    &#34;person_car_id_fkey&#34; FOREIGN KEY (car_id) REFERENCES car(id)

test=# SELECT * FROM person_id_seq ;
 last_value | log_cnt | is_called
------------+---------+-----------
         10 |      23 | t
(1 row)

test=# SELECT nextval(&#39;person_id_seq&#39;::regclass);
 nextval
---------
      11
(1 row)

test=# SELECT nextval(&#39;person_id_seq&#39;::regclass);
 nextval
---------
      12
(1 row)

test=# SELECT * FROM person_id_seq ;
 last_value | log_cnt | is_called
------------+---------+-----------
         12 |      32 | t
(1 row)

test=# ALTER SEQUENCE person_id_seq RESTART WITH 10;
ALTER SEQUENCE
test=# SELECT * FROM person_id_seq ;
 last_value | log_cnt | is_called
------------+---------+-----------
         10 |       0 | f
(1 row)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extensions">1.10. Extensions</h3>
<div class="paragraph">
<p>Simply extensions are functions that can add extra functionality to the database.</p>
</div>
<div class="paragraph">
<p>List of available extensions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>test=# SELECT * FROM pg_available_extensions;
  name   | default_version | installed_version |           comment
---------+-----------------+-------------------+------------------------------
 plpgsql | 1.0             | 1.0               | PL/pgSQL procedural language
(1 row)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_uuid_datatype">1.11. UUID Datatype</h3>
<div class="paragraph">
<p>From wikipedia:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A universally unique identifier (UUID) is a 128-bit number used to identify information in computer systems. The term globally unique identifier (GUID) is also used, typically in software created by Microsoft.</p>
</div>
<div class="paragraph">
<p>When generated according to the standard methods, UUIDs are, for practical purposes, unique. Their uniqueness does not depend on a central registration authority or coordination between the parties generating them, unlike most other numbering schemes. While the probability that a UUID will be duplicated is not zero, it is close enough to zero to be negligible.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>We have to add the uuid-ossp extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>CREATE EXTENSION &#34;uuid-ossp&#34;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>List of a available functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>\df</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have to invoke the function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>SELECT uuid_generate_v4();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>ANLONGUUID</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_uuid_as_primary_key">1.11.1. UUID as Primary Key</h4>
<div class="paragraph">
<p>Drop <code>person</code> and <code>car</code> table and create another ones as below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">car</span> <span class="p">(</span>
	<span class="n">car_uid</span> <span class="n">UUID</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
	<span class="n">make</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">model</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">price</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>


<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="p">(</span>
	<span class="n">person_uid</span> <span class="n">UUID</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
	<span class="n">first_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">last_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span>
	<span class="n">gender</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">date_of_birth</span> <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">country_of_birth</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">car_uid</span> <span class="n">UUID</span> <span class="k">REFERENCES</span> <span class="n">car</span><span class="p">(</span><span class="n">car_uid</span><span class="p">),</span>
	<span class="k">UNIQUE</span><span class="p">(</span><span class="n">car_uid</span><span class="p">),</span>
	<span class="k">UNIQUE</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
<span class="p">);</span>



<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">car</span> <span class="p">(</span><span class="n">car_uid</span><span class="p">,</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="s1">&#39;Mitsubishi&#39;</span><span class="p">,</span> <span class="s1">&#39;Montero&#39;</span><span class="p">,</span> <span class="s1">&#39;269595.21&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">car</span> <span class="p">(</span><span class="n">car_uid</span><span class="p">,</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="s1">&#39;Kia&#39;</span><span class="p">,</span> <span class="s1">&#39;Rio&#39;</span><span class="p">,</span> <span class="s1">&#39;245275.16&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">car</span> <span class="p">(</span><span class="n">car_uid</span><span class="p">,</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="s1">&#39;Jaguar&#39;</span><span class="p">,</span> <span class="s1">&#39;X-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;41665.96&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">car</span> <span class="p">(</span><span class="n">car_uid</span><span class="p">,</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="s1">&#39;Lincoln&#39;</span><span class="p">,</span> <span class="s1">&#39;Mark VIII&#39;</span><span class="p">,</span> <span class="s1">&#39;163843.38&#39;</span><span class="p">);</span>




<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">person_uid</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="s1">&#39;Hamid&#39;</span><span class="p">,</span> <span class="s1">&#39;Abbett&#39;</span><span class="p">,</span> <span class="s1">&#39;habbett1@cbc.ca&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;1995-08-31&#39;</span><span class="p">,</span> <span class="s1">&#39;Ethiopia&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">person_uid</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="s1">&#39;Francis&#39;</span><span class="p">,</span> <span class="s1">&#39;Nickerson&#39;</span><span class="p">,</span> <span class="s1">&#39;fnickerson2@mac.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;1998-03-16&#39;</span><span class="p">,</span> <span class="s1">&#39;Portugal&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">person_uid</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="s1">&#39;Erminie&#39;</span><span class="p">,</span> <span class="s1">&#39;M</span><span class="se">&#39;&#39;</span><span class="s1">Quharg&#39;</span><span class="p">,</span> <span class="s1">&#39;emquharg3@e-recht24.de&#39;</span><span class="p">,</span> <span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;1999-03-13&#39;</span><span class="p">,</span> <span class="s1">&#39;Mozambique&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">person_uid</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="s1">&#39;Teodoro&#39;</span><span class="p">,</span> <span class="s1">&#39;Trimmill&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;1982-04-30&#39;</span><span class="p">,</span> <span class="s1">&#39;China&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">person_uid</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="s1">&#39;Reilly&#39;</span><span class="p">,</span> <span class="s1">&#39;Amesbury&#39;</span><span class="p">,</span> <span class="s1">&#39;ramesbury5@businessinsider.com&#39;</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;1990-12-31&#39;</span><span class="p">,</span> <span class="s1">&#39;China&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">person_uid</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="s1">&#39;West&#39;</span><span class="p">,</span> <span class="s1">&#39;Elphey&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;Male&#39;</span><span class="p">,</span> <span class="s1">&#39;2004-03-29&#39;</span><span class="p">,</span> <span class="s1">&#39;Indonesia&#39;</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span><span class="n">person_uid</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="n">uuid_generate_v4</span><span class="p">(),</span> <span class="s1">&#39;Letta&#39;</span><span class="p">,</span> <span class="s1">&#39;Caurah&#39;</span><span class="p">,</span> <span class="s1">&#39;lcaurah7@yale.edu&#39;</span><span class="p">,</span> <span class="s1">&#39;Female&#39;</span><span class="p">,</span> <span class="s1">&#39;1994-09-09&#39;</span><span class="p">,</span> <span class="s1">&#39;Indonesia&#39;</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3>See also in PostgreSQL</h3>
      <nav>
        <ul>
        
        
          
            <li>
              <a href="https://www.arafathasan.live/en/prowritings/postgres/intro-installation/">PostgreSQL Introduction and Installation</a>
            </li>
          
        
          
        
          
            <li>
              <a href="https://www.arafathasan.live/en/prowritings/postgres/the-surface-sea/">PostgreSQL: The Surface Sea</a>
            </li>
          
        
          
            <li>
              <a href="https://www.arafathasan.live/en/prowritings/postgres/very-first-commands/">PostgreSQL: Very First Commands</a>
            </li>
          
        
        </ul>
      </nav>
    
  
</section>


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "arafathasan" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
      </footer>
    </article>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js" id="MathJax-script"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [
          ['$', '$'], ['\\(', '\\)']
        ],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
        <p>Want to talk? <a href='mailto:opendoor.arafat@gmail.com'>Email me!</a></p>
      
      
        ©
        
        2020
         Arafat Hasan 
      
      
        
      
      
    </section>
  </footer>


    </main>

    
      
      <script src="https://www.arafathasan.live/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js"></script>
    

    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-178245243-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


    

    

  </body>

</html>
